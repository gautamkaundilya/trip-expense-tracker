<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Trip Tracker</title>

  <!-- Leaflet Map Styling -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

  <!-- Your App Styling -->
  <link rel="stylesheet" href="style.css">

  <!-- Leaflet JS Library -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Your Script -->
  <script defer src="main.js"></script>

  <link rel="manifest" href="manifest.json">
</head>

<body>
  <header class="banner">
      <div class="wrapper">
    <div class="title-banner">
    <h1>Trip Budget Tracker</h1>
  </div>    
    <p class="tagline">ðŸ’¸ Plan Smart, Spend Smarter</p>
  </header>

  <main class="grid-container">
    <section class="trip-form">
      <h2>Trip Details</h2>
      <form id="trip-form">
        <div class="form-row">
          <label for="trip-start">Start Date</label>
          <input type="date" id="trip-start" required>
        </div>
        <div class="form-row">
          <label for="trip-end">End Date</label>
          <input type="date" id="trip-end" required>
        </div>
        <div class="form-row">
          <label for="trip-location">Location</label>
          <input type="text" id="trip-location" required>
        </div>
        <div class="form-row">
          <label for="currency">Currency</label>
          <select id="currency">
            <option value="â‚¹">INR (â‚¹)</option>
            <option value="$">USD ($)</option>
            <option value="â‚¬">Euro (â‚¬)</option>
            <option value="Â£">GBP (Â£)</option>
          </select>
        </div>
        <div class="form-row">
          <label for="budget">Budget</label>
          <input type="number" id="budget" placeholder="e.g. 5000" required>
        </div>
        <div class="form-row">
          <label for="Number of person">Number of person</label>
          <input type="number" id="Number-of-person" placeholder="e.g. 5" required>
        </div>
                <div class="form-row">
          <label for="Number of Male">Male</label>
          <input type="number" id="Male" placeholder="e.g. 2" required>
        </div>
        <div class="form-row">
          <label for="Female">Female</label>
          <input type="number" id="Female" placeholder="Auto-calculated" readonly>
        </div>
<script>
  const totalInput = document.getElementById("Number-of-person");
  const maleInput = document.getElementById("Male");
  const femaleInput = document.getElementById("Female");

  function updateGenderCounts() {
    const total = parseInt(totalInput.value, 10);
    const male = parseInt(maleInput.value, 10);

    if (!isNaN(total) && !isNaN(male)) {
      if (male > total) {
        alert("Number of males cannot exceed total number of persons.");
        maleInput.value = '';
        femaleInput.value = '';
        return;
      }
      femaleInput.value = total - male;
    } else {
      femaleInput.value = '';
    }
  }
  totalInput.addEventListener("input", updateGenderCounts);
  maleInput.addEventListener("input", updateGenderCounts);
</script>
        <fieldset class="form-row">
          <legend>Categories</legend>
          <input type="number" id="food" placeholder="Food">
          <input type="number" id="travel" placeholder="Travel">
          <input type="number" id="stay" placeholder="Accommodation">
          <input type="number" id="shopping" placeholder="shopping">
          <input type="number" id="misc" placeholder="Miscellaneous">
        </fieldset>

        <button type="submit">Calculate</button>
        <div id="result" class="result hidden"></div>
      </form>
    </section>

    <section class="map-panel">
      <h2>Map</h2>
      <input type="text" id="map-search" placeholder="Search location">
      <button id="search-btn">Search</button>
      <div id="map" class="map-box"></div>
    </section>

    <section class="history">
      <h2>History</h2>
      <ul id="history-list"></ul>
    </section>
  </main>
  <script>
  let db;
  function initDB() {
    const request = indexedDB.open("TripBudgetDB", 1);
    request.onupgradeneeded = function (event) {
      db = event.target.result;
      const store = db.createObjectStore("trips", { keyPath: "id", autoIncrement: true });
    };
    request.onsuccess = function (event) {
      db = event.target.result;
      displayHistory();
    };
    request.onerror = function (event) {
      console.error("IndexedDB error:", event.target.errorCode);
    };
  }
  function saveTrip(trip) {
    const transaction = db.transaction(["trips"], "readwrite");
    const store = transaction.objectStore("trips");
    store.add(trip);
    transaction.oncomplete = () => displayHistory();
  }
  function displayHistory() {
    const historyList = document.getElementById('history-list');
    const transaction = db.transaction(["trips"], "readonly");
    const store = transaction.objectStore("trips");
    const trips = [];
    store.openCursor(null, "prev").onsuccess = function (event) {
      const cursor = event.target.result;
      if (cursor) {
        trips.push(cursor.value);
        cursor.continue();
      } else {
        historyList.innerHTML = trips.map(item => `
          <li>
            <strong>${item.location}</strong> â€” ${item.currency}${item.totalSpent} spent (Budget: ${item.currency}${item.budget})<br>
            <small>${item.date}</small><br>
            <button onclick='displayTripDetails(${JSON.stringify(item)})'>See Info</button>
          </li>
        `).join('');
      }
    };
  }
  </script>
</body>
</html>
